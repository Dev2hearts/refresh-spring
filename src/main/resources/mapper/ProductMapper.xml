<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.refresh.product.PdtMapper">
    <insert id="insPdt">
        INSERT INTO t_product
        SET iplan = #{iplan}
        , icate = #{icate}
        , nm = #{nm}
        , cnt = #{cnt}
        , iunit = #{iunit}
        , w_iuser = #{wIuser}
    </insert>

    <select id="selPdt" resultType="PdtSelVo">
        SELECT A.iproduct, A.icate, A.nm, A.cnt, A.iunit, A.w_iuser wIuser, A.finish_yn finishYn
        FROM t_product A
        JOIN t_plan B
        ON A.iplan = B.iplan
        WHERE B.igroup = #{igroup}
        AND B.iplan = #{iplan}
        AND A.del_yn = 0
    </select>

    <update id="updPdt">
        UPDATE t_product
        SET
        icate = #{icate}
        , nm = #{nm}
        , cnt = #{cnt}
        , iunit = #{iunit}
        WHERE iproduct = #{iproduct}
    </update>

    <update id="finishPdt">
        <selectKey keyProperty="finishYn" resultType="PdtEntity" order="AFTER">
            SELECT finish_yn finishYn FROM t_product WHERE iproduct = #{iproduct}
        </selectKey>
        UPDATE t_product
        SET finish_yn = 1 - finish_yn
        WHERE iproduct = #{iproduct}
    </update>

    <update id="delPdt">
        UPDATE t_product
        SET del_yn = 1
        WHERE iproduct = #{iproduct}
    </update>



</mapper>